// @tiptap/extensions@3.20.0 downloaded from https://ga.jspm.io/npm:@tiptap/extensions@3.20.0/dist/index.js

import{Extension as t,callOrReturn as e,getExtensionField as o,isNodeEmpty as r,isNodeSelection as n}from"@tiptap/core";import{Plugin as s,PluginKey as i}from"@tiptap/pm/state";import{dropCursor as a}from"@tiptap/pm/dropcursor";import{DecorationSet as d,Decoration as c}from"@tiptap/pm/view";import{gapCursor as l}from"@tiptap/pm/gapcursor";import{history as p,redo as u,undo as h}from"@tiptap/pm/history";var m=t.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter((t=>t!=="")).length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=(t==null?void 0:t.node)||this.editor.state.doc;const o=(t==null?void 0:t.mode)||this.options.mode;if(o==="textSize"){const t=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(t)}return e.nodeSize};this.storage.words=t=>{const e=(t==null?void 0:t.node)||this.editor.state.doc;const o=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(o)}},addProseMirrorPlugins(){let t=false;return[new s({key:new i("characterCount"),appendTransaction:(e,o,r)=>{if(t)return;const n=this.options.limit;if(n===null||n===void 0||n===0){t=true;return}const s=this.storage.characters({node:r.doc});if(s>n){const e=s-n;const o=0;const i=e;console.warn(`[CharacterCount] Initial content exceeded limit of ${n} characters. Content was automatically trimmed.`);const a=r.tr.deleteRange(o,i);t=true;return a}t=true},filterTransaction:(t,e)=>{const o=this.options.limit;if(!t.docChanged||o===0||o===null||o===void 0)return true;const r=this.storage.characters({node:e.doc});const n=this.storage.characters({node:t.doc});if(n<=o)return true;if(r>o&&n>o&&n<=r)return true;if(r>o&&n>o&&n>r)return false;const s=t.getMeta("paste");if(!s)return false;const i=t.selection.$head.pos;const a=n-o;const d=i-a;const c=i;t.deleteRange(d,c);const l=this.storage.characters({node:t.doc});return!(l>o)}})]}});var f=t.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[a(this.options)]}});var g=t.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new s({key:new i("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:o,isFocused:r}=this.editor;const{anchor:n}=e;const s=[];if(!o||!r)return d.create(t,[]);let i=0;this.options.mode==="deepest"&&t.descendants(((t,e)=>{if(t.isText)return;const o=n>=e&&n<=e+t.nodeSize-1;if(!o)return false;i+=1}));let a=0;t.descendants(((t,e)=>{if(t.isText)return false;const o=n>=e&&n<=e+t.nodeSize-1;if(!o)return false;a+=1;const r=this.options.mode==="deepest"&&i-a>0||this.options.mode==="shallowest"&&a>1;if(r)return this.options.mode==="deepest";s.push(c.node(e,e+t.nodeSize,{class:this.options.className}))}));return d.create(t,s)}}})]}});var y=t.create({name:"gapCursor",addProseMirrorPlugins(){return[l()]},extendNodeSchema(t){var r;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(r=e(o(t,"allowGapCursor",n)))!=null?r:null}}});var w="placeholder";function C(t){return t.replace(/\s+/g,"-").replace(/[^a-zA-Z0-9-]/g,"").replace(/^[0-9-]+/,"").replace(/^-+/,"").toLowerCase()}var v=t.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",dataAttribute:w,placeholder:"Write something …",showOnlyWhenEditable:true,showOnlyCurrent:true,includeChildren:false}},addProseMirrorPlugins(){const t=this.options.dataAttribute?`data-${C(this.options.dataAttribute)}`:`data-${w}`;return[new s({key:new i("placeholder"),props:{decorations:({doc:e,selection:o})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable;const{anchor:s}=o;const i=[];if(!n)return null;const a=this.editor.isEmpty;e.descendants(((e,o)=>{const n=s>=o&&s<=o+e.nodeSize;const d=!e.isLeaf&&r(e);if((n||!this.options.showOnlyCurrent)&&d){const r=[this.options.emptyNodeClass];a&&r.push(this.options.emptyEditorClass);const s=c.node(o,o+e.nodeSize,{class:r.join(" "),[t]:typeof this.options.placeholder==="function"?this.options.placeholder({editor:this.editor,node:e,pos:o,hasAnchor:n}):this.options.placeholder});i.push(s)}return this.options.includeChildren}));return d.create(e,i)}}})]}});var M=t.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new s({key:new i("selection"),props:{decorations(o){return o.selection.empty||t.isFocused||!t.isEditable||n(o.selection)||t.view.dragging?null:d.create(o.doc,[c.inline(o.selection.from,o.selection.to,{class:e.className})])}}})]}});function P({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||(e==null?void 0:e.type)===t}var z=t.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;const e=new i(this.name);const o=this.options.node||((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||"paragraph";const r=Object.entries(this.editor.schema.nodes).map((([,t])=>t)).filter((t=>(this.options.notAfter||[]).concat(o).includes(t.name)));return[new s({key:e,appendTransaction:(t,r,n)=>{const{doc:s,tr:i,schema:a}=n;const d=e.getState(n);const c=s.content.size;const l=a.nodes[o];if(d)return i.insert(c,l.create())},state:{init:(t,e)=>{const o=e.tr.doc.lastChild;return!P({node:o,types:r})},apply:(t,e)=>{if(!t.docChanged)return e;if(t.getMeta("__uniqueIDTransaction"))return e;const o=t.doc.lastChild;return!P({node:o,types:r})}}})]}});var S=t.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>h(t,e),redo:()=>({state:t,dispatch:e})=>u(t,e)}},addProseMirrorPlugins(){return[p(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}});export{m as CharacterCount,f as Dropcursor,g as Focus,y as Gapcursor,v as Placeholder,M as Selection,z as TrailingNode,S as UndoRedo,C as preparePlaceholderAttribute};


// @tiptap/extension-code-block@3.20.0 downloaded from https://ga.jspm.io/npm:@tiptap/extension-code-block@3.20.0/dist/index.js

import{Node as t,textblockTypeInputRule as e,mergeAttributes as n}from"@tiptap/core";import{Plugin as r,TextSelection as o,PluginKey as a,Selection as s}from"@tiptap/pm/state";var i=4;var c=/^```([a-z]+)?[\s\n]$/;var l=/^~~~([a-z]+)?[\s\n]$/;var d=t.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:true,exitOnArrowDown:true,defaultLanguage:null,enableTabIndentation:false,tabSize:i,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:true,defining:true,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options;if(!n)return null;const r=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]];const o=r.filter((t=>t.startsWith(n))).map((t=>t.replace(n,"")));const a=o[0];return a||null},rendered:false}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",n(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var n;return((n=t.raw)==null?void 0:n.startsWith("```"))===false&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var n;let r="";const o=((n=t.attrs)==null?void 0:n.language)||"";if(t.content){const n=[`\`\`\`${o}`,e.renderChildren(t.content),"```"];r=n.join("\n")}else r=`\`\`\`${o}\n\n\`\`\``;return r},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection;const n=e.pos===1;return!(!t||e.parent.type.name!==this.name)&&(!(!n&&e.parent.textContent.length)&&this.editor.commands.clearNodes())},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return false;const n=(e=this.options.tabSize)!=null?e:i;const{state:r}=t;const{selection:o}=r;const{$from:a,empty:s}=o;if(a.parent.type!==this.type)return false;const c=" ".repeat(n);return s?t.commands.insertContent(c):t.commands.command((({tr:t})=>{const{from:e,to:n}=o;const a=r.doc.textBetween(e,n,"\n","\n");const s=a.split("\n");const i=s.map((t=>c+t)).join("\n");t.replaceWith(e,n,r.schema.text(i));return true}))},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return false;const n=(e=this.options.tabSize)!=null?e:i;const{state:r}=t;const{selection:a}=r;const{$from:s,empty:c}=a;return s.parent.type===this.type&&(c?t.commands.command((({tr:t})=>{var e;const{pos:a}=s;const i=s.start();const c=s.end();const l=r.doc.textBetween(i,c,"\n","\n");const d=l.split("\n");let u=0;let p=0;const m=a-i;for(let t=0;t<d.length;t+=1){if(p+d[t].length>=m){u=t;break}p+=d[t].length+1}const f=d[u];const h=((e=f.match(/^ */))==null?void 0:e[0])||"";const g=Math.min(h.length,n);if(g===0)return true;let v=i;for(let t=0;t<u;t+=1)v+=d[t].length+1;t.delete(v,v+g);const y=a-v;y<=g&&t.setSelection(o.create(t.doc,v));return true})):t.commands.command((({tr:t})=>{const{from:e,to:o}=a;const s=r.doc.textBetween(e,o,"\n","\n");const i=s.split("\n");const c=i.map((t=>{var e;const r=((e=t.match(/^ */))==null?void 0:e[0])||"";const o=Math.min(r.length,n);return t.slice(o)})).join("\n");t.replaceWith(e,o,r.schema.text(c));return true})))},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return false;const{state:e}=t;const{selection:n}=e;const{$from:r,empty:o}=n;if(!o||r.parent.type!==this.type)return false;const a=r.parentOffset===r.parent.nodeSize-2;const s=r.parent.textContent.endsWith("\n\n");return!(!a||!s)&&t.chain().command((({tr:t})=>{t.delete(r.pos-2,r.pos);return true})).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return false;const{state:e}=t;const{selection:n,doc:r}=e;const{$from:o,empty:a}=n;if(!a||o.parent.type!==this.type)return false;const i=o.parentOffset===o.parent.nodeSize-2;if(!i)return false;const c=o.after();if(c===void 0)return false;const l=r.nodeAt(c);return l?t.commands.command((({tr:t})=>{t.setSelection(s.near(r.resolve(c)));return true})):t.commands.exitCode()}}},addInputRules(){return[e({find:c,type:this.type,getAttributes:t=>({language:t[1]})}),e({find:l,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new r({key:new a("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData)return false;if(this.editor.isActive(this.type.name))return false;const n=e.clipboardData.getData("text/plain");const r=e.clipboardData.getData("vscode-editor-data");const a=r?JSON.parse(r):void 0;const s=a==null?void 0:a.mode;if(!n||!s)return false;const{tr:i,schema:c}=t.state;const l=c.text(n.replace(/\r\n?/g,"\n"));i.replaceSelectionWith(this.type.create({language:s},l));i.selection.$from.parent.type!==this.type&&i.setSelection(o.near(i.doc.resolve(Math.max(0,i.selection.from-2))));i.setMeta("paste",true);t.dispatch(i);return true}}})]}});var u=d;export{d as CodeBlock,c as backtickInputRegex,u as default,l as tildeInputRegex};


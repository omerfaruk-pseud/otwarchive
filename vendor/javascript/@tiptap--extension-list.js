// @tiptap/extension-list@3.20.0 downloaded from https://ga.jspm.io/npm:@tiptap/extension-list@3.20.0/dist/index.js

import{Node as t,wrappingInputRule as e,mergeAttributes as s,renderNestedMarkdownContent as n,getNodeType as r,getNodeAtPosition as i,isNodeActive as o,isAtStartOfNode as a,isAtEndOfNode as d,Extension as c,getRenderedAttributes as l,parseIndentedBlocks as p}from"@tiptap/core";var u=Object.defineProperty;var h=(t,e)=>{for(var s in e)u(t,s,{get:e[s],enumerable:true})};var m="listItem";var k="textStyle";var f=/^\s*([-+*])\s$/;var b=t.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:false,keepAttributes:false}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",s(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,"\n"):"",markdownOptions:{indentsContent:true},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(m,this.editor.getAttributes(k)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=e({find:f,type:this.type});(this.options.keepMarks||this.options.keepAttributes)&&(t=e({find:f,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(k),editor:this.editor}));return[t]}});var y=t.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:true,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",s(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let s=[];if(t.tokens&&t.tokens.length>0){const n=t.tokens.some((t=>t.type==="paragraph"));if(n)s=e.parseChildren(t.tokens);else{const n=t.tokens[0];if(n&&n.type==="text"&&n.tokens&&n.tokens.length>0){const r=e.parseInline(n.tokens);s=[{type:"paragraph",content:r}];if(t.tokens.length>1){const n=t.tokens.slice(1);const r=e.parseChildren(n);s.push(...r)}}else s=e.parseChildren(t.tokens)}}s.length===0&&(s=[{type:"paragraph",content:[]}]);return{type:"listItem",content:s}},renderMarkdown:(t,e,s)=>n(t,e,(t=>{var e,s;if(t.parentType==="bulletList")return"- ";if(t.parentType==="orderedList"){const n=((s=(e=t.meta)==null?void 0:e.parentAttrs)==null?void 0:s.start)||1;return`${n+t.index}. `}return"- "}),s),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}});var L={};h(L,{findListItemPos:()=>g,getNextListDepth:()=>v,handleBackspace:()=>w,handleDelete:()=>N,hasListBefore:()=>T,hasListItemAfter:()=>x,hasListItemBefore:()=>M,listItemHasSubList:()=>A,nextListIsDeeper:()=>I,nextListIsHigher:()=>C});var g=(t,e)=>{const{$from:s}=e.selection;const n=r(t,e.schema);let i=null;let o=s.depth;let a=s.pos;let d=null;while(o>0&&d===null){i=s.node(o);if(i.type===n)d=o;else{o-=1;a-=1}}return d===null?null:{$pos:e.doc.resolve(a),depth:d}};var v=(t,e)=>{const s=g(t,e);if(!s)return false;const[,n]=i(e,t,s.$pos.pos+4);return n};var T=(t,e,s)=>{const{$anchor:n}=t.selection;const r=Math.max(0,n.pos-2);const i=t.doc.resolve(r).node();return!(!i||!s.includes(i.type.name))};var M=(t,e)=>{var s;const{$anchor:n}=e.selection;const r=e.doc.resolve(n.pos-2);return r.index()!==0&&((s=r.nodeBefore)==null?void 0:s.type.name)===t};var A=(t,e,s)=>{if(!s)return false;const n=r(t,e.schema);let i=false;s.descendants((t=>{t.type===n&&(i=true)}));return i};var w=(t,e,s)=>{if(t.commands.undoInputRule())return true;if(t.state.selection.from!==t.state.selection.to)return false;if(!o(t.state,e)&&T(t.state,e,s)){const{$anchor:s}=t.state.selection;const n=t.state.doc.resolve(s.before()-1);const r=[];n.node().descendants(((t,s)=>{t.type.name===e&&r.push({node:t,pos:s})}));const i=r.at(-1);if(!i)return false;const o=t.state.doc.resolve(n.start()+i.pos+1);return t.chain().cut({from:s.start()-1,to:s.end()+1},o.end()).joinForward().run()}if(!o(t.state,e))return false;if(!a(t.state))return false;const n=g(e,t.state);if(!n)return false;const r=t.state.doc.resolve(n.$pos.pos-2);const i=r.node(n.depth);const d=A(e,t.state,i);return M(e,t.state)&&!d?t.commands.joinItemBackward():t.chain().liftListItem(e).run()};var I=(t,e)=>{const s=v(t,e);const n=g(t,e);return!(!n||!s)&&s>n.depth};var C=(t,e)=>{const s=v(t,e);const n=g(t,e);return!(!n||!s)&&s<n.depth};var N=(t,e)=>{if(!o(t.state,e))return false;if(!d(t.state,e))return false;const{selection:s}=t.state;const{$from:n,$to:r}=s;return!(!s.empty&&n.sameParent(r))&&(I(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():C(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward())};var x=(t,e)=>{var s;const{$anchor:n}=e.selection;const r=e.doc.resolve(n.pos-n.parentOffset-2);return r.index()!==r.parent.childCount-1&&((s=r.nodeAfter)==null?void 0:s.type.name)===t};var H=c.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=false;this.options.listTypes.forEach((({itemName:s})=>{t.state.schema.nodes[s]!==void 0&&N(t,s)&&(e=true)}));return e},"Mod-Delete":({editor:t})=>{let e=false;this.options.listTypes.forEach((({itemName:s})=>{t.state.schema.nodes[s]!==void 0&&N(t,s)&&(e=true)}));return e},Backspace:({editor:t})=>{let e=false;this.options.listTypes.forEach((({itemName:s,wrapperNames:n})=>{t.state.schema.nodes[s]!==void 0&&w(t,s,n)&&(e=true)}));return e},"Mod-Backspace":({editor:t})=>{let e=false;this.options.listTypes.forEach((({itemName:s,wrapperNames:n})=>{t.state.schema.nodes[s]!==void 0&&w(t,s,n)&&(e=true)}));return e}}}});var $=/^(\s*)(\d+)\.\s+(.*)$/;var E=/^\s/;function O(t){const e=[];let s=0;let n=0;while(s<t.length){const r=t[s];const i=r.match($);if(!i)break;const[,o,a,d]=i;const c=o.length;let l=d;let p=s+1;const u=[r];while(p<t.length){const e=t[p];const s=e.match($);if(s)break;if(e.trim()===""){u.push(e);l+="\n";p+=1}else{if(!e.match(E))break;u.push(e);l+=`\n${e.slice(c+2)}`;p+=1}}e.push({indent:c,number:parseInt(a,10),content:l.trim(),raw:u.join("\n")});n=p;s=p}return[e,n]}function j(t,e,s){var n;const r=[];let i=0;while(i<t.length){const o=t[i];if(o.indent===e){const a=o.content.split("\n");const d=((n=a[0])==null?void 0:n.trim())||"";const c=[];d&&c.push({type:"paragraph",raw:d,tokens:s.inlineTokens(d)});const l=a.slice(1).join("\n").trim();if(l){const t=s.blockTokens(l);c.push(...t)}let p=i+1;const u=[];while(p<t.length&&t[p].indent>e){u.push(t[p]);p+=1}if(u.length>0){const t=Math.min(...u.map((t=>t.indent)));const e=j(u,t,s);c.push({type:"list",ordered:true,start:u[0].number,items:e,raw:u.map((t=>t.raw)).join("\n")})}r.push({type:"list_item",raw:o.raw,tokens:c});i=p}else i+=1}return r}function S(t,e){return t.map((t=>{if(t.type!=="list_item")return e.parseChildren([t])[0];const s=[];t.tokens&&t.tokens.length>0&&t.tokens.forEach((t=>{if(t.type==="paragraph"||t.type==="list"||t.type==="blockquote"||t.type==="code")s.push(...e.parseChildren([t]));else if(t.type==="text"&&t.tokens){const n=e.parseChildren([t]);s.push({type:"paragraph",content:n})}else{const n=e.parseChildren([t]);n.length>0&&s.push(...n)}}));return{type:"listItem",content:s}}))}var B="listItem";var K="textStyle";var P=/^(\d+)\.\s$/;var D=t.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:false,keepAttributes:false}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",s(this.options.HTMLAttributes,n),0]:["ol",s(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const s=t.start||1;const n=t.items?S(t.items,e):[];return s!==1?{type:"orderedList",attrs:{start:s},content:n}:{type:"orderedList",content:n}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,"\n"):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/);const s=e==null?void 0:e.index;return s!==void 0?s:-1},tokenize:(t,e,s)=>{var n;const r=t.split("\n");const[i,o]=O(r);if(i.length===0)return;const a=j(i,0,s);if(a.length===0)return;const d=((n=i[0])==null?void 0:n.number)||1;return{type:"list",ordered:true,start:d,items:a,raw:r.slice(0,o).join("\n")}}},markdownOptions:{indentsContent:true},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(B,this.editor.getAttributes(K)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=e({find:P,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1]});(this.options.keepMarks||this.options.keepAttributes)&&(t=e({find:P,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:t=>({start:+t[1],...this.editor.getAttributes(K)}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1],editor:this.editor}));return[t]}});var R=/^\s*(\[([( |x])?\])\s$/;var z=t.create({name:"taskItem",addOptions(){return{nested:false,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:true,addAttributes(){return{checked:{default:false,keepOnSplit:false,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",s(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const s=[];t.tokens&&t.tokens.length>0?s.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?s.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):s.push(e.createNode("paragraph",{},[]));if(t.nestedTokens&&t.nestedTokens.length>0){const n=e.parseChildren(t.nestedTokens);s.push(...n)}return e.createNode("taskItem",{checked:t.checked||false},s)},renderMarkdown:(t,e)=>{var s;const r=((s=t.attrs)==null?void 0:s.checked)?"x":" ";const i=`- [${r}] `;return n(t,e,i)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:s,editor:n})=>{const r=document.createElement("li");const i=document.createElement("label");const o=document.createElement("span");const a=document.createElement("input");const d=document.createElement("div");const c=t=>{var e,s;a.ariaLabel=((s=(e=this.options.a11y)==null?void 0:e.checkboxLabel)==null?void 0:s.call(e,t,a.checked))||`Task item checkbox for ${t.textContent||"empty task item"}`};c(t);i.contentEditable="false";a.type="checkbox";a.addEventListener("mousedown",(t=>t.preventDefault()));a.addEventListener("change",(e=>{if(!n.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:r}=e.target;n.isEditable&&typeof s==="function"&&n.chain().focus(void 0,{scrollIntoView:false}).command((({tr:t})=>{const e=s();if(typeof e!=="number")return false;const n=t.doc.nodeAt(e);t.setNodeMarkup(e,void 0,{...n==null?void 0:n.attrs,checked:r});return true})).run();!n.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,r)||(a.checked=!a.checked))}));Object.entries(this.options.HTMLAttributes).forEach((([t,e])=>{r.setAttribute(t,e)}));r.dataset.checked=t.attrs.checked;a.checked=t.attrs.checked;i.append(a,o);r.append(i,d);Object.entries(e).forEach((([t,e])=>{r.setAttribute(t,e)}));let p=new Set(Object.keys(e));return{dom:r,contentDOM:d,update:t=>{if(t.type!==this.type)return false;r.dataset.checked=t.attrs.checked;a.checked=t.attrs.checked;c(t);const e=n.extensionManager.attributes;const s=l(t,e);const i=new Set(Object.keys(s));const o=this.options.HTMLAttributes;p.forEach((t=>{i.has(t)||(t in o?r.setAttribute(t,o[t]):r.removeAttribute(t))}));Object.entries(s).forEach((([t,e])=>{e===null||e===void 0?t in o?r.setAttribute(t,o[t]):r.removeAttribute(t):r.setAttribute(t,e)}));p=i;return true}}}},addInputRules(){return[e({find:R,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}});var _=t.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",s(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,"\n"):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const s=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return s!==void 0?s:-1},tokenize(t,e,s){const n=t=>{const e=p(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:t=>({indentLevel:t[1].length,mainContent:t[4],checked:t[3].toLowerCase()==="x"}),createToken:(t,e)=>({type:"taskItem",raw:"",mainContent:t.mainContent,indentLevel:t.indentLevel,checked:t.checked,text:t.mainContent,tokens:s.inlineTokens(t.mainContent),nestedTokens:e}),customNestedParser:n},s);return e?[{type:"taskList",raw:e.raw,items:e.items}]:s.blockTokens(t)};const r=p(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:t=>({indentLevel:t[1].length,mainContent:t[4],checked:t[3].toLowerCase()==="x"}),createToken:(t,e)=>({type:"taskItem",raw:"",mainContent:t.mainContent,indentLevel:t.indentLevel,checked:t.checked,text:t.mainContent,tokens:s.inlineTokens(t.mainContent),nestedTokens:e}),customNestedParser:n},s);if(r)return{type:"taskList",raw:r.raw,items:r.items}}},markdownOptions:{indentsContent:true},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});var F=c.create({name:"listKit",addExtensions(){const t=[];this.options.bulletList!==false&&t.push(b.configure(this.options.bulletList));this.options.listItem!==false&&t.push(y.configure(this.options.listItem));this.options.listKeymap!==false&&t.push(H.configure(this.options.listKeymap));this.options.orderedList!==false&&t.push(D.configure(this.options.orderedList));this.options.taskItem!==false&&t.push(z.configure(this.options.taskItem));this.options.taskList!==false&&t.push(_.configure(this.options.taskList));return t}});export{b as BulletList,y as ListItem,H as ListKeymap,F as ListKit,D as OrderedList,z as TaskItem,_ as TaskList,f as bulletListInputRegex,R as inputRegex,L as listHelpers,P as orderedListInputRegex};

